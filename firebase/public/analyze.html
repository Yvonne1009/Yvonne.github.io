<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="css/analyze.css" />
  <link rel="icon" href="image/logo.ico" type="image/x-icon" />
  <link rel="stylesheet" href="css/bootstrap.min.css" />
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-auth.js"></script>

  <title>LeisurePace_分析</title>
</head>


<body>
  <header id="masthead" class="site-header" role="banner">
    <nav class="navbar navbar-default navbar-static-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse"
            data-target=".navbar-ex1-collapse"></button>
          <a class="navbar-brand" href="index.html">LeisurePace</a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="index.html">首頁</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">關於LeisurePace <i
                  class="fa fa-angle-double-down"></i></a>
              <ul class="dropdown-menu">
                <li><a href="about.html">LeisurePace</a></li>
                <li><a href="about.html">超慢跑介紹</a></li>
              </ul>
            </li>
            <li><a href="./run/run180.html">超慢跑</a></li>
            <li class="active"><a href="analyze.html">分析</a></li>
            <li><a href="task.html">紀錄</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                <img id="profileImage" src="./image/default-avatar.png" class="profile-picture"
                  style="border-radius: 50%" />
              </a>
              <ul class="dropdown-menu">
                <li><a href="bgstore.html">背景介紹</a></li>
                <li><a href="personal.html">個人資料</a></li>
                <li><a href="connect.html">聯絡我們</a></li>
                <li><a href="./login/login.html">登出</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>
  </header>

  <!-- 左側：月曆和待辦事項清單  開始-->
  <div class="container main-container">
    <div class="left-section">
      <!-- 月曆 開始 -->
      <div class="calendar">
        <div class="calendar-header" id="header"></div>
        <div class="calendar-nav">
          <button onclick="prevMonth()">Prev Month</button>
          <select id="monthSelect" onchange="changeMonth()"></select>
          <select id="yearSelect" onchange="changeYear()"></select>
          <button onclick="nextMonth()">Next Month</button>
        </div>
        <div class="calendar-body" id="calendar"></div>
      </div>
      <!-- 月曆 結束 -->
      <!--紅色-->
      <div class="record" id="recordSection">
        <div class="record-item" id="calories">每日卡路里:</div>
        <div class="record-item" id="exercise">運動記錄:</div>
        <div class="record-item" id="steps">每日步數:</div>
      </div>
    </div>
    <div class="right-section">
      <div id="chart-container">
        <canvas id="myChart"></canvas>
      </div>

      <div id="activity-tracking">
        <!-- 活动追踪数据显示于此 -->
      </div>

      <div id="fitness-plan">
        <h2>Fitness Plan</h2>
        <form id="fitness-form">
          <label for="target-steps">每日目標步數:</label>
          <input type="number" id="target-steps" name="target-steps" min="0" /><br />
          <label for="target-calories">每日目標卡路里：</label>
          <input type="number" id="target-calories" name="target-calories" min="0" /><br />
          <button type="submit">設定目標</button>
        </form>
      </div>

      <div id="personal-report">
        <h2>個人報告</h2>
        <div id="report-content">
          <!-- Personalized report and analysis data display here -->
        </div>
      </div>
    </div>
  </div>
  <!-- ----------------------------以下js------------------------------------ -->
  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCbujMaNQH4-KIuNbSglH2SriVqvvRRa1g",
      authDomain: "leisurepace-a3d51.firebaseapp.com",
      projectId: "leisurepace-a3d51",
      storageBucket: "leisurepace-a3d51.appspot.com",
      messagingSenderId: "955257567601",
      appId: "1:955257567601:web:87073b209d8f2544d68d5b",
      measurementId: "G-D8HL3GZ4L3"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // 頁面載入時檢查使用者登錄狀態
    auth.onAuthStateChanged((user) => {
      if (user) {
        const userUID = user.uid;
        db.collection('users').doc(userUID).get()
          .then((doc) => {
            if (doc.exists) {
              const userProfile = doc.data();
              const avatar = userProfile.avatar || "./image/default-avatar.png";
              document.getElementById("profileImage").src = avatar;
            } else {
              console.error("User data does not exist");
              alert("Error: User data not found.");
            }
          })
          .catch((error) => {
            console.error("Unable to retrieve user data:", error);
            alert("Error retrieving user data. Please try again later.");
          });
      } else {
        window.location.href = './login/login.html';
      }
    });
    function updateChart(exerciseData) {
      myChart.data.datasets[0].data = exerciseData; // Assuming exerciseData is an array of values
      myChart.update();
    }


  </script>

  <script>
    // 獲取日曆頭部元素和月份顯示區域元素
    const header = document.getElementById("header");
    const calendarContainer = document.getElementById("calendar");
    const monthSelect = document.getElementById("monthSelect");
    const yearSelect = document.getElementById("yearSelect");

    // 獲取當前日期信息
    let currentDate = new Date();
    let currentYear = currentDate.getFullYear();
    let currentMonth = currentDate.getMonth() + 1; // 將月份索引+1
    let currentDay = currentDate.getDate();
    let selectedDayElement = null; // 用來存儲當前選中的日期元素

    // 初始化月份選擇框
    for (let i = 1; i <= 12; i++) {
      const option = document.createElement("option");
      option.value = i;
      option.text = new Date(0, i - 1).toLocaleString("en", {
        month: "long",
      });
      monthSelect.appendChild(option);
    }
    monthSelect.selectedIndex = currentMonth - 1;

    // 初始化年份選擇框
    for (let i = currentYear - 10; i <= currentYear + 10; i++) {
      const option = document.createElement("option");
      option.value = i;
      option.text = i;
      yearSelect.appendChild(option);
    }
    yearSelect.selectedIndex = 10;

    // 函數：生成月份選擇器
    function generateMonthSelector() {
      monthSelect.selectedIndex = currentMonth - 1;
    }

    // 函數：生成日曆
    function generateCalendar(year, month) {
      const daysInMonth = new Date(year, month, 0).getDate();
      const firstDay = new Date(year, month - 1, 1).getDay();
      const weekdays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

      // 清空日曆容器
      calendarContainer.innerHTML = "";

      // 添加星期標題
      for (let i = 0; i < 7; i++) {
        const weekday = document.createElement("div");
        weekday.classList.add("calendar-day");
        weekday.textContent = weekdays[i];
        calendarContainer.appendChild(weekday);
      }

      // 添加空白日期
      for (let i = 0; i < firstDay; i++) {
        const emptyDay = document.createElement("div");
        emptyDay.classList.add("calendar-day");
        emptyDay.textContent = "";
        calendarContainer.appendChild(emptyDay);
      }

      // 添加日期
      for (let i = 1; i <= daysInMonth; i++) {
        const day = document.createElement("div");
        day.classList.add("calendar-day");
        day.textContent = i;
        day.setAttribute("data-day", i);

        // 設置點擊事件
        day.addEventListener("click", () => {
          // 更新當前日期
          currentYear = year;
          currentMonth = month;
          currentDay = i;

          // 清除之前選中的日期顏色
          if (selectedDayElement) {
            selectedDayElement.classList.remove("selected");
          }

          // 將選中日期設置為紅色
          day.classList.add("selected");
          selectedDayElement = day;
          updateHeader(currentYear, currentMonth, currentDay); // 更新標題
          getTasksFromFirebase(); // 重新從 Firebase 獲取任務列表並顯示
        });

        // 如果是今天的日期，则添加今日样式
        if (
          year === currentYear &&
          month === currentMonth &&
          i === currentDay
        ) {
          day.classList.add("today");
        }
        calendarContainer.appendChild(day);
      }
    }

    // 當月份選擇變更時的處理函數
    function changeMonth() {
      currentMonth = parseInt(monthSelect.value); // 讀取新的月份
      generateCalendar(currentYear, currentMonth); // 重新生成日曆
      getTasksFromFirebase(); // 更新當前月份的任務列表
    }

    // 當年份選擇變更時的處理函數
    function changeYear() {
      currentYear = parseInt(yearSelect.value); // 讀取新的年份
      generateCalendar(currentYear, currentMonth); // 重新生成日曆
      getTasksFromFirebase(); // 更新當前年份的任務列表
    }

    // 當選擇月份或年份時，自動生成對應的日曆
    monthSelect.addEventListener("change", changeMonth);
    yearSelect.addEventListener("change", changeYear);

    // 函数：更新标题显示选定的年份、月份和日期
    function updateHeader(year, month, day) {
      header.innerText = `${year}年${month}月${day}日`;
    }

    generateCalendar(currentYear, currentMonth);
    updateHeader(currentYear, currentMonth, currentDate.getDate());
    getTasksFromFirebase();

    function tryLoadPreviousTasks() {
      const storedTasks = localStorage.getItem("tasks");
      if (storedTasks) {
        const parsedTasks = JSON.parse(storedTasks);
        displayTasks(currentYear, currentMonth, currentDay, parsedTasks);
      }
    }

    tryLoadPreviousTasks();

    monthSelect.addEventListener("change", () => {
      currentMonth = parseInt(monthSelect.value);
      generateCalendar(currentYear, currentMonth);
      getTasksFromFirebase();
    });

    yearSelect.addEventListener("change", () => {
      currentYear = parseInt(yearSelect.value);
      generateCalendar(currentYear, currentMonth);
      getTasksFromFirebase();
    });

    // 函数：显示前一个月份
    // 函数：显示前一个月份
    function prevMonth() {
      if (currentMonth === 1) {
        currentYear--; // 如果当前是1月，减1年
        currentMonth = 12; // 月份设置为12月
      } else {
        currentMonth--; // 否则减1月
      }
      generateMonthSelector(); // 更新月份选择器
      yearSelect.value = currentYear; // 更新年份选择器
      generateCalendar(currentYear, currentMonth); // 生成新的日历
      getTasksFromFirebase(); // 获取任务列表
    }

    // 函数：显示下一个月份
    function nextMonth() {
      if (currentMonth === 12) {
        currentYear++; // 如果当前是12月，加1年
        currentMonth = 1; // 月份设置为1月
      } else {
        currentMonth++; // 否则加1月
      }
      generateMonthSelector(); // 更新月份选择器
      yearSelect.value = currentYear; // 更新年份选择器
      generateCalendar(currentYear, currentMonth); // 生成新的日历
      getTasksFromFirebase(); // 获取任务列表
    }
  </script>

  <script>
    ////////////////////////////////// 紅色區域//////////////////////////////////

    document.addEventListener("DOMContentLoaded", function () {
      var ctx = document.getElementById("myChart").getContext("2d");
      var myChart = new Chart(ctx, {
        type: "bar",
        data: {
          labels: [
            "January",
            "February",
            "March",
            "April",
            "May",
            "June",
            "July",
          ],
          datasets: [
            {
              label: "Exercise Record",
              data: [12, 19, 3, 5, 2, 3, 9],
              backgroundColor: "rgba(255, 99, 132, 0.2)",
              borderColor: "rgba(255, 99, 132, 1)",
              borderWidth: 1,
            },
          ],
        },
        options: {
          scales: {
            yAxes: [
              {
                ticks: {
                  beginAtZero: true,
                },
              },
            ],
          },
        },
      });
    });

    document
      .getElementById("fitness-form")
      .addEventListener("submit", function (event) {
        event.preventDefault();
        var targetSteps = document.getElementById("target-steps").value;
        var targetCalories = document.getElementById("target-calories").value;
        alert("Targets set successfully!");
      });


    // 假設這是用於呈現折線圖的JavaScript庫，例如Chart.js
    // 創建一個函數來動態添加圖表
    function addChart() {
      // 創建一個canvas元素
      const canvas = document.createElement("canvas");
      canvas.width = 400;
      canvas.height = 200;

      // 將canvas添加到頁面中的chart-container div中
      document.getElementById("chart-container").appendChild(canvas);

      // 獲取canvas的上下文
      const ctx = canvas.getContext("2d");

      // 創建圖表實例並設置數據
      new Chart(ctx, {
        type: "line",
        data: {
          labels: ["一月", "二月", "三月", "四月", "五月", "六月"],
          datasets: [
            {
              label: "步數",
              data: [5000, 6000, 5500, 7000, 6500, 7500],
              borderColor: "blue",
              borderWidth: 2,
              fill: false,
            },
          ],
        },
        options: {
          scales: {
            yAxes: [
              {
                ticks: {
                  beginAtZero: true,
                },
              },
            ],
          },
        },
      });
    }

    // 在頁面加載時調用addChart函數，以添加圖表
    window.onload = addChart;

  </script>

  <footer id="footer" class="footer-area">
    <div class="footer-widget pt-80">
      <div class="container">
        <div class="row">
          <div class="col-lg-3 col-md-4 col-sm-8">
            <div class="footer-logo mt-50">
              <a href="#"><img src="image/logo.png" alt="Logo" /></a>
              <ul class="footer-social mt-20">
                <li>
                  <a href="#"><i class="lni-facebook-filled"></i></a>
                </li>
                <li>
                  <a href="#"><i class="lni-twitter-original"></i></a>
                </li>
                <li>
                  <a href="#"><i class="lni-google"></i></a>
                </li>
                <li>
                  <a href="#"><i class="lni-instagram"></i></a>
                </li>
              </ul>
            </div>
          </div>
          <div class="col-lg-3 col-md-4 col-sm-6">
            <div class="footer-link mt-45">
              <div class="f-title">
                <h4 class="title">關於LeisurePace</h4>
              </div>
              <ul class="mt-15">
                <li><a href="about.html">LeisurePace</a></li>
                <li><a href="about.html">超慢跑介紹</a></li>
              </ul>
            </div>
          </div>
          <div class="col-lg-3 col-md-4 col-sm-6">
            <div class="footer-link mt-45">
              <ul class="mt-15">
                <li><a href="./run/run180.html">超慢跑</a></li>
                <li><a href="analyze.html">分析</a></li>
                <li><a href="task.html">任務</a></li>
              </ul>
            </div>
          </div>
          <div class="col-lg-3 col-md-4 col-sm-6">
            <div class="footer-link mt-45">
              <ul class="mt-15">
                <li><a href="bgstore.html">背景介紹</a></li>
                <li><a href="personal.html">個人資料</a></li>
                <li><a href="connect.html">聯絡我們</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="copyright-area">
      <div class="container">
        <div class="row">
          <div class="col-lg-12">
            <div class="copyright text-center">
              <p>&copy; LeisurePace</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <!-- Import the basic jquery lib. -->
  <!-- Set the firebsae config and initialize it. -->
  <script defer src="./js/init-firebase.js"></script>
  <script src="js/analyze.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" />

</html>