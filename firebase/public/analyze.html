<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="css/analyze.css" />
  <link rel="icon" href="image/logo.ico" type="image/x-icon" />
  <link rel="stylesheet" href="css/bootstrap.min.css" />
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-auth.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <title>LeisurePace_分析</title>


</head>

<body>
  <!-- menu 開始 -->
  <header id="masthead" class="site-header" role="banner">
    <nav class="navbar navbar-default navbar-static-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse"
            data-target=".navbar-ex1-collapse"></button>
          <a class="navbar-brand" href="index.html"> LeisurePace </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="index.html">首頁</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">關於LeisurePace <i
                  class="fa fa-angle-double-down"></i></a>
              <ul class="dropdown-menu">
                <li><a href="about.html">LeisurePace</a></li>
                <li><a href="about.html">超慢跑介紹</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="./run/run180.html">超慢跑 </a>
            </li>
            <li class="dropdown active">
              <a href="analyze.html">分析</a>
            </li>
            <li class="dropdown">
              <a href="task.html">紀錄 </a>
            </li>

            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                <img id="profileImage" src="./image/default-avatar.png" class="profile-picture"
                  style="border-radius: 50%" />
              </a>
              <ul class="dropdown-menu">
                <li><a href="bgstore.html">背景介紹</a></li>
                <li><a href="personal.html">個人資料</a></li>
                <li><a href="connect.html">聯絡我們</a></li>
                <li><a href="./login/login.html">登出</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>


    <div class="chart-container">
      <!-- 時間選擇區域 -->
      <div class="time-range-selector">
        <label for="yearSelect">選擇年份：</label>
        <select id="yearSelect">
          <option value="2022">2022</option>
          <option value="2023">2023</option>
          <option value="2024" selected>2024</option>
        </select>

        <label for="monthSelect">選擇月份：</label>
        <select id="monthSelect">
          <option value="0">一月</option>
          <option value="1">二月</option>
          <option value="2">三月</option>
          <option value="3">四月</option>
          <option value="4">五月</option>
          <option value="5">六月</option>
          <option value="6">七月</option>
          <option value="7">八月</option>
          <option value="8">九月</option>
          <option value="9">十月</option>
          <option value="10" selected>十一月</option>
          <option value="11">十二月</option>
        </select>

        <label for="timeRange">選擇時間範圍：</label>
        <select id="timeRange">
          <option value="7">一週</option>
          <option value="30" selected>一個月</option>
        </select>
      </div>
      <!-- 體重曲線圖區域 -->
      <div class="chart-box">
        <h1>體重曲線圖</h1>
        <canvas id="weightChart"></canvas>
      </div>

      <!-- 喝水曲線圖 -->
      <div class="chart-box">
        <h1>喝水曲線圖</h1>
        <canvas id="waterChart"></canvas>
      </div>

      <!-- 運動時間曲線圖 -->
      <div class="chart-box">
        <h1>運動時間曲線圖</h1>
        <canvas id="runChart"></canvas>
      </div>

      <!-- 卡路里曲線圖 -->
      <div class="chart-box">
        <h1>卡路里曲線圖</h1>
        <canvas id="calorieChart"></canvas>
      </div>
    </div>

    <!------------------------------------下半部 footer 開始 --------------------------------------------------------->
    <footer id="footer" class="footer-area">
      <div class="footer-widget pt-80">
        <div class="container">
          <div class="row">
            <div class="col-lg-3 col-md-4 col-sm-8">
              <div class="footer-logo mt-50">
                <a href="#">
                  <img src="image/logo.png" alt="Logo" />
                </a>

                <ul class="footer-social mt-20">
                  <li>
                    <a href="#"><i class="lni-facebook-filled"></i></a>
                  </li>
                  <li>
                    <a href="#"><i class="lni-twitter-original"></i></a>
                  </li>
                  <li>
                    <a href="#"><i class="lni-google"></i></a>
                  </li>
                  <li>
                    <a href="#"><i class="lni-instagram"></i></a>
                  </li>
                </ul>
              </div>
              <!-- footer logo -->
            </div>
            <div class="col-lg-3 col-md-4 col-sm-6">
              <div class="footer-link mt-45">
                <div class="f-title">
                  <h4 class="title">關於LeisurePace</h4>
                </div>
                <ul class="mt-15">
                  <li><a href="about.html">LeisurePace</a></li>
                  <li><a href="about.html">超慢跑介紹</a></li>
                </ul>
              </div>
            </div>
            <div class="col-lg-3 col-md-4 col-sm-6">
              <div class="footer-link mt-45">
                <ul class="mt-15">
                  <li><a href="./run/run180.html">超慢跑</a></li>
                  <li><a href="analyze.html">分析</a></li>
                  <li><a href="task.html">任務</a></li>
                </ul>
              </div>
            </div>
            <div class="col-lg-3 col-md-4 col-sm-6">
              <div class="footer-link mt-45">
                <ul class="mt-15">
                  <li><a href="bgstore.html">背景介紹</a></li>
                  <li><a href="personal.html">個人資料</a></li>
                  <li><a href="connect.html">聯絡我們</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="copyright-area">
        <div class="container">
          <div class="row">
            <div class="col-lg-12">
              <div class="copyright text-center">
                <p>&copy; LeisurePace</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>
    <!-- footer 結束 -->
</body>
<script>
  // Firebase 初始化
  const firebaseConfig = {
    apiKey: "AIzaSyCbujMaNQH4-KIuNbSglH2SriVqvvRRa1g",
    authDomain: "leisurepace-a3d51.firebaseapp.com",
    projectId: "leisurepace-a3d51",
    storageBucket: "leisurepace-a3d51.appspot.com",
    messagingSenderId: "955257567601",
    appId: "1:955257567601:web:87073b209d8f2544d68d5b",
    measurementId: "G-D8HL3GZ4L3"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const auth = firebase.auth();
  // 頁面載入時檢查用戶登錄狀態
  window.onload = function () {
    auth.onAuthStateChanged(function (user) {
      if (user) {
        // 獲取用戶的 UID
        const userUID = user.uid;

        // 從 Firestore 獲取用戶資料
        const userRef = db.collection('users').doc(userUID);
        userRef.get().then((doc) => {
          if (doc.exists) {
            const userProfile = doc.data();
            // 更新頭像
            const avatar = userProfile.avatar || "./image/default-avatar.png";
            document.getElementById("profileImage").src = avatar;
          }
        }).catch((error) => {
          console.error("Error fetching user data:", error);
        });
        //初始化圖表
        const selectedYear = parseInt(document.getElementById('yearSelect').value);
        const selectedMonth = parseInt(document.getElementById('monthSelect').value);
        updateAllCharts(userUID, 30, selectedYear, selectedMonth);
        // 調用以添加事件監聽器
        addEventListeners();
      } else {
        // 如果未登錄，導向至登錄頁面
        window.location.href = './login/login.html';
      }
    });
  };
</script>

<script src="js/analyze.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</html>