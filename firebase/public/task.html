<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="css/task.css" />
  <link rel="icon" href="image/logo.ico" type="image/x-icon" />
  <link rel="stylesheet" href="css/bootstrap.min.css" />
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    integrity="sha384-kB+HoBWE0e8+eAxj0NwD3wGwQ52cMUlw1U5NDzYrUSrWrjvaLq63fhp5R2+OOQ4b" crossorigin="anonymous" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-auth.js"></script>
  <title>LeisurePace_紀錄</title>
</head>



<body>
  <!-- menu 開始 -->
  <header id="masthead" class="site-header" role="banner">
    <nav class="navbar navbar-default navbar-static-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse"
            data-target=".navbar-ex1-collapse"></button>
          <a class="navbar-brand" href="index.html"> LeisurePace </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="index.html">首頁</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">關於LeisurePace <i
                  class="fa fa-angle-double-down"></i></a>
              <ul class="dropdown-menu">
                <li><a href="about.html">LeisurePace</a></li>
                <li><a href="about.html">超慢跑介紹</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="./run/run180.html">超慢跑 </a>
            </li>
            <li class="dropdown">
              <a href="analyze.html">分析</a>
            </li>
            <li class="dropdown active">
              <a href="task.html">紀錄 </a>
            </li>

            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                <img id="profileImage" src="./image/default-avatar.png" class="profile-picture"
                  style="border-radius: 50%" />
              </a>
              <ul class="dropdown-menu">
                <li><a href="bgstore.html">背景介紹</a></li>
                <li><a href="personal.html">個人資料</a></li>
                <li><a href="connect.html">聯絡我們</a></li>
                <li><a href="./login/login.html">登出</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>


  <!---------------- 左側：月曆和待辦事項清單---------------->
  <div class="container main-container">
    <div class="left-section">
      <!--月曆 -->
      <div class="calendar">
        <div class="calendar-header" id="header"></div>
        <div class="calendar-nav">
          <button onclick="prevMonth()">Prev Month</button>
          <select id="monthSelect" onchange="changeMonth()"></select>
          <select id="yearSelect" onchange="changeYear()"></select>
          <button onclick="nextMonth()">Next Month</button>
        </div>
        <div class="calendar-body" id="calendar"></div>
      </div>

      <!--待辦事項清單 -->
      <div class="todo-list">
        <h2 id="todoTitle">待辦事項清單</h2>
        <input type="text" id="taskInput" placeholder="新增待辦事項清單..." />
        <button class="btn-add" onclick="addTask()">新增</button>
        <h2>待辦項目</h2>
        <div id="taskList">
        </div>
      </div>
    </div>

    <!----------------------右側：每日記錄 ---------------------->
    <div class="right-section">
      <div class="record-section">
        <h1>體重</h1>
        <div class="weight-record">
          <form id="weightForm">

            <label for="weightInput"></label>
            <input type="number" id="weightInput" placeholder="輸入體重(kg)..." step="0.1" required />
            <button class="btn-add" type="button" onclick="addWeight()">新增</button>

          </form>
          <h2>體重記錄</h2>
          <div id="weightList"></div>
        </div>
      </div>

      <div class="record-section">
        <h1>喝水</h1>
        <div class="water-record">
          <form id="waterForm">
            <label for="waterInput"></label>
            <input type="number" id="waterInput" placeholder="輸入喝水量(ml)..." step="1" required />
            <button class="btn-add" type="button" onclick="addWater()">新增</button>
          </form>
          <h2>喝水記錄</h2>
          <div id="waterList"></div>
        </div>
      </div>

      

      <div class="record-section">
        <h1>超慢跑</h1>
        <div class="run-record">
          <form id="runForm">
            <label for="runInput"></label>
            <input type="text" id="runInput" placeholder="新增目標(分鐘)..." required />
            <button class="btn-add" type="button" onclick="addRun()">新增</button>
          </form>
          <h2>超慢跑記錄</h2>
          <div id="runList"></div>
        </div>
      </div>

      <div class="record-section">
        <h1>卡路里</h1>
        <div class="cal-record">
          <form id="calForm">
            <label for="calInput"></label>
            <input type="number" id="calInput" placeholder="輸入卡路里(cal)..." required />
            <button class="btn-add" type="button" onclick="addcal()">新增</button>
          </form>
          <h2>卡路里記錄</h2>
          <div id="calList"></div>
        </div>
      </div>
    </div>
  </div>


  <!--////////////////////////////////////////////以下JS///////////////////////////////////////////////////-->
  <!--////////////////////////////////////////////以下JS///////////////////////////////////////////////////-->
  <script>
    // Firebase 初始化
    const firebaseConfig = {
      apiKey: "AIzaSyCbujMaNQH4-KIuNbSglH2SriVqvvRRa1g",
      authDomain: "leisurepace-a3d51.firebaseapp.com",
      projectId: "leisurepace-a3d51",
      storageBucket: "leisurepace-a3d51.appspot.com",
      messagingSenderId: "955257567601",
      appId: "1:955257567601:web:87073b209d8f2544d68d5b",
      measurementId: "G-D8HL3GZ4L3"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    // 頁面載入時檢查用戶登錄狀態
    window.onload = function () {
      auth.onAuthStateChanged(function (user) {
        if (user) {
          // 獲取用戶的 UID
          const userUID = user.uid;

          // 從 Firestore 獲取用戶資料
          const userRef = db.collection('users').doc(userUID);
          userRef.get().then((doc) => {
            if (doc.exists) {
              const userProfile = doc.data();
              // 更新頭像
              const avatar = userProfile.avatar || "./image/default-avatar.png";
              document.getElementById("profileImage").src = avatar;
            }
          }).catch((error) => {
            console.error("Error fetching user data:", error);
          });
        } else {
          // 如果未登錄，導向至登錄頁面
          window.location.href = './login/login.html';
        }
      });
    };
  </script>
  <!-- ------------------------------------調整日歷JS-------------------------------------------- -->
  <!-- ------------------------------------調整日歷JS-------------------------------------------- -->
  <script>
    // 獲取日曆頭部元素和月份顯示區域元素
    const header = document.getElementById("header");
    const calendarContainer = document.getElementById("calendar");
    const monthSelect = document.getElementById("monthSelect");
    const yearSelect = document.getElementById("yearSelect");

    // 獲取當前日期信息
    let currentDate = new Date();
    let currentYear = currentDate.getFullYear();
    let currentMonth = currentDate.getMonth() + 1; // 將月份索引+1
    let currentDay = currentDate.getDate();
    let selectedDayElement = null; // 用來存儲當前選中的日期元素

    // 初始化月份選擇框
    for (let i = 1; i <= 12; i++) {
      const option = document.createElement("option");
      option.value = i;
      option.text = new Date(0, i - 1).toLocaleString("en", {
        month: "long",
      });
      monthSelect.appendChild(option);
    }
    monthSelect.selectedIndex = currentMonth - 1;

    // 初始化年份選擇框
    for (let i = currentYear - 10; i <= currentYear + 10; i++) {
      const option = document.createElement("option");
      option.value = i;
      option.text = i;
      yearSelect.appendChild(option);
    }
    yearSelect.selectedIndex = 10;



    // 函數：生成月份選擇器
    function generateMonthSelector() {
      monthSelect.selectedIndex = currentMonth - 1;
    }

    // 函數：生成日曆
    function generateCalendar(year, month) {
      const daysInMonth = new Date(year, month, 0).getDate();
      const firstDay = new Date(year, month - 1, 1).getDay();
      const weekdays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

      // 清空日曆容器
      calendarContainer.innerHTML = "";

      // 添加星期標題
      for (let i = 0; i < 7; i++) {
        const weekday = document.createElement("div");
        weekday.classList.add("calendar-day");
        weekday.textContent = weekdays[i];
        calendarContainer.appendChild(weekday);
      }

      // 添加空白日期
      for (let i = 0; i < firstDay; i++) {
        const emptyDay = document.createElement("div");
        emptyDay.classList.add("calendar-day");
        emptyDay.textContent = "";
        calendarContainer.appendChild(emptyDay);
      }

      // 添加日期
      for (let i = 1; i <= daysInMonth; i++) {
        const day = document.createElement("div");
        day.classList.add("calendar-day");
        day.textContent = i;
        day.setAttribute("data-day", i);

        // 點擊日期时更新记录
        day.addEventListener("click", () => {
          // 更新当前日期
          currentYear = year;
          currentMonth = month;
          currentDay = i;

          // 清除之前选中的日期颜色
          if (selectedDayElement) {
            selectedDayElement.classList.remove("selected");
          }

          // 将选中日期设为红色
          day.classList.add("selected");
          selectedDayElement = day;

          updateHeader(currentYear, currentMonth, currentDay); // 更新标题
          getTasks(); // 取得清單
          getWeights();
          getWaters();
          getSteps();
          getRuns();
          getcal();
        });


        // 如果是今天的日期，則添加紅色背景
        if (
          year === currentYear &&
          month === currentMonth &&
          i === currentDay
        ) {
          day.classList.add("today");
        }
        calendarContainer.appendChild(day);
      }
    }

    // 當月份選擇變更時的處理函數
    function changeMonth() {
      currentMonth = parseInt(monthSelect.value); // 讀取新的月份
      generateCalendar(currentYear, currentMonth); // 重新生成日曆
      getTasks(); // 取得清單
      getWeights();
      getWaters();
      getSteps();
      getRuns();
      getcal();
    }

    // 當年份選擇變更時的處理函數
    function changeYear() {
      currentYear = parseInt(yearSelect.value); // 讀取新的年份
      generateCalendar(currentYear, currentMonth); // 重新生成日曆
      getTasks(); // 取得清單
      getWeights();
      getWaters();
      getSteps();
      getRuns();
      getcal();
    }

    // 當選擇月份或年份時，自動生成對應的日曆
    monthSelect.addEventListener("change", changeMonth);
    yearSelect.addEventListener("change", changeYear);


    // 函数：更新标题显示选定的年份、月份和日期
    function updateHeader(year, month, day) {
      header.innerText = `${year}年${month}月${day}日`; // 不再 +1
    }

    // 函数：显示前一个月份
    function prevMonth() {
      if (currentMonth === 1) {
        currentYear--;
        currentMonth = 12;
      } else {
        currentMonth--;
      }
      yearSelect.value = currentYear; // 更新年份選擇框
      monthSelect.value = currentMonth; // 更新月份選擇框
      generateCalendar(currentYear, currentMonth);
      getTasks(); // 取得清單
      getWeights();
      getWaters();
      getSteps();
      getRuns();
      getcal();
    }

    // 函数：显示下一个月份
    function nextMonth() {
      if (currentMonth === 12) {
        currentYear++;
        currentMonth = 1;
      } else {
        currentMonth++;
      }
      yearSelect.value = currentYear; // 更新年份選擇框
      monthSelect.value = currentMonth; // 更新月份選擇框
      generateCalendar(currentYear, currentMonth);
      getTasks(); // 取得清單
      getWeights();
      getWaters();
      getSteps();
      getRuns();
      getcal();
    }

    // 绑定月份和年份选择器的事件
    monthSelect.addEventListener("change", () => {
      currentMonth = parseInt(monthSelect.value);
      generateCalendar(currentYear, currentMonth);
      getTasks(); // 取得清單
      getWeights();
      getWaters();
      getSteps();
      getRuns();
      getcal();
    });

    yearSelect.addEventListener("change", () => {
      currentYear = parseInt(yearSelect.value);
      generateCalendar(currentYear, currentMonth);
      getTasks(); // 取得清單
      getWeights();
      getWaters();
      getSteps();
      getRuns();
      getcal();
    });

    // 初始化日历
    generateCalendar(currentYear, currentMonth);
    updateHeader(currentYear, currentMonth, currentDate.getDate());
    getTasks(); // 取得清單
    getWeights();
    getWaters();
    getSteps();
    getRuns();
    getcal();
  </script>


  <!-- ------------------------------------調整日歷JS----------------------------------------------->
  <script>
    // 初始化 Firebase

    // 監聽使用者狀態變更
    auth.onAuthStateChanged(user => {
      if (user) {
        console.log("使用者已登入: ", user.email);
        getTasks(); // 取得清單
        getWeights();
        getWaters();
        getSteps();
        getRuns();
        getcal();
      } else {
        console.log("使用者已登出或尚未登入");
        window.location.href = './login/login.html'; // 導向登入頁面
      }
    });

    function getCurrentDate() {
      const now = new Date();
      return `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')}`;
    }
    function formatTime(date) {
      const hours = String(date.getHours()).padStart(2, '0');
      const minutes = String(date.getMinutes()).padStart(2, '0');
      const seconds = String(date.getSeconds()).padStart(2, '0');
      return `${hours}-${minutes}-${seconds}`; // 返回 hh:mm:ss 格式
    }


  </script>
  <!--
體體體體體體體體體體體體體體體體體體體體體體
體體　　　　　　　　體體體　　體　　體體體體
體體　　　體體　　　體體體　　體　　體體體體
體體　　　體體　　　體　　　　　　　　　　體
體體　　　　　　　　體　體　　體　　體　　體
體體　　　　　　　　體　　　　　　　　　　體
體體　　　　　　　　體　　　　　　　　　　體
體　　　　　　　　　　　體　　體　　體　　體
體　　　體體體體　　　　　　　　　　　　　體
體體體體體體體體體體體體體體體體體體體體體體
體體　　　　　　　　　　　　　　　　　　　體
體體　　　體體　　　體體體體體體體體體體體體
體體　　　　　　　　　　　　　　　　　　體體
體體　　　體體　　　　　　體體體體　　　體體
體體　　　　　　　　　　　　　　　　　　體體
體體　　　體體　　　體體體　體體體體體體體體
體體　　　體體　　　體體　　　體　　　體體體
體體　　　體　　　　體體　　　體　　　體體體
體體　　　體　　　　　　　　　　　　　　　體
體體體體體體體體體體體體體體體體體體體體體體
體重JS----------------------------------------------->
  <script>
    //新增體重
    function addWeight() {
      const weightInput = document.getElementById("weightInput");
      const weightValue = parseFloat(weightInput.value.trim()); // 將輸入轉為數字
      if (isNaN(weightValue)) return; // 檢查輸入是否為有效數字

      const user = firebase.auth().currentUser;
      if (user) {
        const weightDate = `${currentYear}-${currentMonth.toString().padStart(2, '0')}-${currentDay.toString().padStart(2, '0')}`;

        const now = new Date();
        const formattedTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;

        firebase.firestore()
          .collection("users")
          .doc(user.uid)
          .collection("Records")
          .doc(weightDate)
          .collection("weight")
          .doc(formattedTime)
          .set({ weight: weightValue }, { merge: true })
          .then(() => {
            console.log("體重資料已新增");
            weightInput.value = ""; // 清空輸入框
            getWeights(); // 新增後重新獲取體重資料
          })
          .catch((error) => {
            console.error("新增體重資料時出錯:", error);
          });
      } else {
        console.error("未登入用戶");
      }
    }


    // 獲取體重資料
    function getWeights() {
      const user = firebase.auth().currentUser;
      if (user) {
        const weightDate = `${currentYear}-${currentMonth.toString().padStart(2, '0')}-${currentDay.toString().padStart(2, '0')}`;

        firebase.firestore()
          .collection("users")
          .doc(user.uid)
          .collection("Records")
          .doc(weightDate)
          .collection("weight")
          .get()
          .then((snapshot) => {
            const weights = [];

            snapshot.forEach(doc => {
              const time = doc.id;
              const weightData = doc.data();

              if (weightData.weight) {
                weights.push({ time, weight: weightData.weight });
              }
            });

            if (Array.isArray(weights)) {
              displayWeights(currentYear, currentMonth, currentDay, weights);
            } else {
              console.error("體重資料不是陣列格式");
              displayWeights(currentYear, currentMonth, currentDay, []);
            }
          })
          .catch((error) => {
            console.error("獲取體重資料時出錯:", error);
          });
      } else {
        console.error("使用者未登入");
      }
    }

    // 顯示體重資料
    function displayWeights(year, month, day, weights) {
      const weightList = document.getElementById("weightList");
      weightList.innerHTML = "";

      if (!Array.isArray(weights)) {
        console.error("預期體重資料為陣列");
        return;
      }

      weights.forEach(({ time, weight }) => {
        const weightElement = document.createElement("div");
        weightElement.classList.add("weight");

        const weightTime = document.createElement("span");
        weightTime.textContent = time; // 顯示時間
        weightElement.appendChild(weightTime);

        const weightText = document.createElement("span");
        weightText.textContent = `  ${weight} kg`; // 顯示體重
        weightElement.appendChild(weightText);

        const deleteButton = document.createElement("button");
        deleteButton.textContent = "刪除";
        deleteButton.classList.add("btn-del"); 
        deleteButton.addEventListener("click", () => {
          deleteWeight({ time, year, month, day });
        });

        weightElement.appendChild(deleteButton);
        weightList.appendChild(weightElement);
      });
    }

    // 刪除體重資料
    function deleteWeight({ time, year, month, day }) {
      const user = firebase.auth().currentUser;
      if (!user) {
        console.error("使用者未登入");
        return;
      }

      if (!time || !year || !month || !day) {
        console.error("刪除資料所需的參數缺失:", { time, year, month, day });
        return;
      }

      const weightDate = `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
      const weightRef = firebase.firestore()
        .collection("users")
        .doc(user.uid)
        .collection("Records")
        .doc(weightDate)
        .collection("weight")
        .doc(time);

      weightRef.get()
        .then((doc) => {
          if (doc.exists) {
            weightRef.delete()
              .then(() => {
                console.log("體重資料已刪除");
                getWeights(); // 刪除後重新獲取體重資料
              })
              .catch((error) => {
                console.error("刪除體重資料時出錯:", error);
              });
          } else {
            console.error("欲刪除的體重資料不存在");
          }
        })
        .catch((error) => {
          console.error("檢查體重資料是否存在時出錯:", error);
        });
    }
    getweights();
  </script>
  <!--
錄錄錄錄錄錄錄錄錄錄錄錄錄錄錄錄錄錄錄錄錄錄
錄錄錄錄錄錄錄錄錄錄　　　錄錄錄錄錄錄錄錄錄
錄錄錄錄錄錄錄錄錄錄　　　錄錄錄錄錄錄錄錄錄
錄錄錄錄錄錄錄錄錄錄　　　錄錄錄錄錄錄錄錄錄
錄錄錄錄錄錄錄錄錄錄　　　錄錄錄錄　錄錄錄錄
錄錄錄錄錄錄錄錄錄錄　　　錄錄錄　　　錄錄錄
錄錄　　　　　　　　　　　錄錄　　　　　錄錄
錄錄錄錄錄錄錄　　　　　　　　　　　錄錄錄錄
錄錄錄錄錄錄　　　錄　　　　　　　錄錄錄錄錄
錄錄錄錄錄錄　　　錄　　　　　錄錄錄錄錄錄錄
錄錄錄錄錄錄　　　錄　　　　　　錄錄錄錄錄錄
錄錄錄錄錄　　　錄錄　　　　　　錄錄錄錄錄錄
錄錄錄錄　　　　錄錄　　　錄　　　錄錄錄錄錄
錄錄錄錄　　　錄錄錄　　　錄　　　　錄錄錄錄
錄錄錄　　　錄錄錄錄　　　錄錄　　　　　錄錄
錄　　　　　錄錄錄錄　　　錄錄錄錄　　　　錄
錄錄錄　　錄錄錄錄錄　　　錄錄錄錄錄　　錄錄
錄錄錄錄錄錄錄錄　　　　　錄錄錄錄錄錄錄錄錄
錄錄錄錄錄錄錄錄　　　　錄錄錄錄錄錄錄錄錄錄
錄錄錄錄錄錄錄錄錄錄錄錄錄錄錄錄錄錄錄錄錄錄
  -->
  <script>
    // 新增水分
    function addWater() {
      const waterInput = document.getElementById("waterInput");
      const waterValue = parseFloat(waterInput.value.trim()); // 將輸入轉為數字
      if (isNaN(waterValue)) return; // 檢查輸入是否為有效數字

      const user = firebase.auth().currentUser;
      if (user) {
        const waterDate = `${currentYear}-${currentMonth.toString().padStart(2, '0')}-${currentDay.toString().padStart(2, '0')}`;

        const now = new Date();
        const formattedTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;

        firebase.firestore()
          .collection("users")
          .doc(user.uid)
          .collection("Records")
          .doc(waterDate)
          .collection("water")
          .doc(formattedTime)
          .set({ water: waterValue }, { merge: true })
          .then(() => {
            console.log("水分資料已新增");
            waterInput.value = ""; // 清空輸入框
            getWaters(); // 新增後重新獲取水分資料
          })
          .catch((error) => {
            console.error("新增水分資料時出錯:", error);
          });
      } else {
        console.error("未登入用戶");
      }
    }

    // 獲取水分資料
    function getWaters() {
      const user = firebase.auth().currentUser;
      if (user) {
        const waterDate = `${currentYear}-${currentMonth.toString().padStart(2, '0')}-${currentDay.toString().padStart(2, '0')}`;

        firebase.firestore()
          .collection("users")
          .doc(user.uid)
          .collection("Records")
          .doc(waterDate)
          .collection("water")
          .get()
          .then((snapshot) => {
            const waters = [];

            snapshot.forEach(doc => {
              const time = doc.id;
              const waterData = doc.data();

              if (waterData.water) {
                waters.push({ time, water: waterData.water });
              }
            });

            if (Array.isArray(waters)) {
              displayWaters(currentYear, currentMonth, currentDay, waters);
            } else {
              console.error("水分資料不是陣列格式");
              displayWaters(currentYear, currentMonth, currentDay, []);
            }
          })
          .catch((error) => {
            console.error("獲取水分資料時出錯:", error);
          });
      } else {
        console.error("使用者未登入");
      }
    }

    // 顯示水分資料
    function displayWaters(year, month, day, waters) {
      const waterList = document.getElementById("waterList");
      waterList.innerHTML = "";

      if (!Array.isArray(waters)) {
        console.error("預期水分資料為陣列");
        return;
      }

      waters.forEach(({ time, water }) => {
        const waterElement = document.createElement("div");
        waterElement.classList.add("water");

        const waterTime = document.createElement("span");
        waterTime.textContent = time; // 顯示時間
        waterElement.appendChild(waterTime);

        const waterText = document.createElement("span");
        waterText.textContent = `  ${water} ml`; // 顯示水分
        waterElement.appendChild(waterText);

        const deleteButton = document.createElement("button");
        deleteButton.textContent = "刪除";
        deleteButton.classList.add("btn-del"); 
        deleteButton.addEventListener("click", () => {
          deleteWater({ time, year, month, day });
        });

        waterElement.appendChild(deleteButton);
        waterList.appendChild(waterElement);
      });
    }

    // 刪除水分資料
    function deleteWater({ time, year, month, day }) {
      const user = firebase.auth().currentUser;
      if (!user) {
        console.error("使用者未登入");
        return;
      }

      if (!time || !year || !month || !day) {
        console.error("刪除資料所需的參數缺失:", { time, year, month, day });
        return;
      }

      const waterDate = `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
      const waterRef = firebase.firestore()
        .collection("users")
        .doc(user.uid)
        .collection("Records")
        .doc(waterDate)
        .collection("water")
        .doc(time);

      waterRef.get()
        .then((doc) => {
          if (doc.exists) {
            waterRef.delete()
              .then(() => {
                console.log("水分資料已刪除");
                getWaters(); // 刪除後重新獲取水分資料
              })
              .catch((error) => {
                console.error("刪除水分資料時出錯:", error);
              });
          } else {
            console.error("欲刪除的水分資料不存在");
          }
        })
        .catch((error) => {
          console.error("檢查水分資料是否存在時出錯:", error);
        });
    }
    getWaters();
  </script>
  <!--
數數數數數數數數數數數數數數數數數數數數數
數數數數數數數數數數　　　數數數數數數數數
數數數數數數數數數數　　　數數數數數數數數
數數數數數　　　數數　　　數數數數數數數數
數數數數數　　　數數　　　　　　　　數數數
數數數數數　　　數數　　　數數數數數數數數
數數數數數　　　數數　　　數數數數數數數數
數數數數數　　　數數　　　數數數數數數數數
數　　　　　　　　　　　　　　　　　　　數
數數數數數數數數數數　　　數數數數數數數數
數數數數數數　　數數　　　數數數數數數數數
數數數數數　　　　數　　　數數數　　　數數
數數數數　　　　數數　　　數數　　　　數數
數數數　　　　數數數　　　數　　　　數數數
數數　　　　數數數數　　　　　　　數數數數
數數　　　數數數數數　　　　　數數數數數數
數數數數數數數數數　　　　　數數數數數數數
數　　　　　　　　　　　數數數數數數數數數
數數　　　　　　數數數數數數數數數數數數數
數數數數數數數數數數數數數數數數數數數數數
  -->
  <script>
    // 新增步數
    function addSteps() {
      const stepsInput = document.getElementById("stepsInput");
      const stepsValue = parseInt(stepsInput.value.trim()); // 將輸入轉為整數
      if (isNaN(stepsValue)) return; // 檢查輸入是否為有效數字

      const user = firebase.auth().currentUser;
      if (user) {
        const stepsDate = `${currentYear}-${currentMonth.toString().padStart(2, '0')}-${currentDay.toString().padStart(2, '0')}`;

        const now = new Date();
        const formattedTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;

        firebase.firestore()
          .collection("users")
          .doc(user.uid)
          .collection("Records")
          .doc(stepsDate)
          .collection("steps")
          .doc(formattedTime)
          .set({ steps: stepsValue }, { merge: true })
          .then(() => {
            console.log("步數資料已新增");
            stepsInput.value = ""; // 清空輸入框
            getSteps(); // 新增後重新獲取步數資料
          })
          .catch((error) => {
            console.error("新增步數資料時出錯:", error);
          });
      } else {
        console.error("未登入用戶");
      }
    }

    // 獲取步數資料
    function getSteps() {
      const user = firebase.auth().currentUser;
      if (user) {
        const stepsDate = `${currentYear}-${currentMonth.toString().padStart(2, '0')}-${currentDay.toString().padStart(2, '0')}`;

        firebase.firestore()
          .collection("users")
          .doc(user.uid)
          .collection("Records")
          .doc(stepsDate)
          .collection("steps")
          .get()
          .then((snapshot) => {
            const steps = [];

            snapshot.forEach(doc => {
              const time = doc.id;
              const stepsData = doc.data();

              if (stepsData.steps) {
                steps.push({ time, steps: stepsData.steps });
              }
            });

            if (Array.isArray(steps)) {
              displaySteps(currentYear, currentMonth, currentDay, steps);
            } else {
              console.error("步數資料不是陣列格式");
              displaySteps(currentYear, currentMonth, currentDay, []);
            }
          })
          .catch((error) => {
            console.error("獲取步數資料時出錯:", error);
          });
      } else {
        console.error("使用者未登入");
      }
    }

    // 顯示步數資料
    function displaySteps(year, month, day, steps) {
      const stepsList = document.getElementById("stepsList");
      stepsList.innerHTML = "";

      if (!Array.isArray(steps)) {
        console.error("預期步數資料為陣列");
        return;
      }

      steps.forEach(({ time, steps }) => {
        const stepsElement = document.createElement("div");
        stepsElement.classList.add("steps");

        const stepsTime = document.createElement("span");
        stepsTime.textContent = time; // 顯示時間
        stepsElement.appendChild(stepsTime);

        const stepsText = document.createElement("span");
        stepsText.textContent = `  ${steps} 步`; // 顯示步數
        stepsElement.appendChild(stepsText);

        const deleteButton = document.createElement("button");
        deleteButton.textContent = "刪除";
        deleteButton.classList.add("btn-del"); 
        deleteButton.addEventListener("click", () => {
          deleteSteps({ time, year, month, day });
        });

        stepsElement.appendChild(deleteButton);
        stepsList.appendChild(stepsElement);
      });
    }

    // 刪除步數資料
    function deleteSteps({ time, year, month, day }) {
      const user = firebase.auth().currentUser;
      if (!user) {
        console.error("使用者未登入");
        return;
      }

      if (!time || !year || !month || !day) {
        console.error("刪除資料所需的參數缺失:", { time, year, month, day });
        return;
      }

      const stepsDate = `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
      const stepsRef = firebase.firestore()
        .collection("users")
        .doc(user.uid)
        .collection("Records")
        .doc(stepsDate)
        .collection("steps")
        .doc(time);

      stepsRef.get()
        .then((doc) => {
          if (doc.exists) {
            stepsRef.delete()
              .then(() => {
                console.log("步數資料已刪除");
                getSteps(); // 刪除後重新獲取步數資料
              })
              .catch((error) => {
                console.error("刪除步數資料時出錯:", error);
              });
          } else {
            console.error("欲刪除的步數資料不存在");
          }
        })
        .catch((error) => {
          console.error("檢查步數資料是否存在時出錯:", error);
        });
    }
    getSteps();
  </script>
  <!--
鐘鐘鐘鐘鐘鐘鐘鐘鐘鐘鐘鐘鐘鐘鐘鐘鐘鐘鐘鐘鐘
鐘鐘鐘鐘鐘鐘　　　鐘　　　　鐘鐘鐘鐘鐘鐘鐘
鐘鐘鐘鐘鐘鐘　　　鐘鐘　　　鐘鐘鐘鐘鐘鐘鐘
鐘鐘鐘鐘鐘　　　　鐘鐘鐘　　　鐘鐘鐘鐘鐘鐘
鐘鐘鐘鐘鐘　　　鐘鐘鐘鐘　　　　鐘鐘鐘鐘鐘
鐘鐘鐘鐘　　　　鐘鐘鐘鐘鐘　　　鐘鐘鐘鐘鐘
鐘鐘鐘　　　　鐘鐘鐘鐘鐘鐘鐘　　　　鐘鐘鐘
鐘鐘鐘　　　鐘鐘鐘鐘鐘鐘鐘鐘鐘　　　　鐘鐘
鐘鐘　　　　　　　　　　　　　　　　　　鐘
鐘　　　　　　　　　　　　　　　　　　鐘鐘
鐘鐘鐘鐘鐘鐘鐘　　　鐘鐘鐘　　　　鐘鐘鐘鐘
鐘鐘鐘鐘鐘鐘鐘　　　鐘鐘鐘　　　鐘鐘鐘鐘鐘
鐘鐘鐘鐘鐘鐘鐘　　　鐘鐘鐘　　　鐘鐘鐘鐘鐘
鐘鐘鐘鐘鐘鐘　　　　鐘鐘鐘　　　鐘鐘鐘鐘鐘
鐘鐘鐘鐘鐘鐘　　　鐘鐘鐘鐘　　　鐘鐘鐘鐘鐘
鐘鐘鐘鐘鐘　　　　鐘鐘鐘鐘　　　鐘鐘鐘鐘鐘
鐘鐘鐘鐘　　　　鐘鐘鐘鐘鐘　　　鐘鐘鐘鐘鐘
鐘鐘　　　　　鐘鐘鐘　　　　　鐘鐘鐘鐘鐘鐘
鐘鐘　　　鐘鐘鐘鐘鐘鐘　　鐘鐘鐘鐘鐘鐘鐘鐘
鐘鐘鐘鐘鐘鐘鐘鐘鐘鐘鐘鐘鐘鐘鐘鐘鐘鐘鐘鐘鐘
  -->
  <script>
    // 新增跑步數據
    function addRun() {
      const runInput = document.getElementById("runInput");
      const runValue = parseInt(runInput.value.trim()); // 將輸入轉為整數
      if (isNaN(runValue)) return; // 檢查輸入是否為有效數字

      const user = firebase.auth().currentUser;
      if (user) {
        const runDate = `${currentYear}-${currentMonth.toString().padStart(2, '0')}-${currentDay.toString().padStart(2, '0')}`;

        const now = new Date();
        const formattedTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;

        firebase.firestore()
          .collection("users")
          .doc(user.uid)
          .collection("Records")
          .doc(runDate)
          .collection("run")
          .doc(formattedTime)
          .set({ run: runValue }, { merge: true })
          .then(() => {
            console.log("跑步資料已新增");
            runInput.value = ""; // 清空輸入框
            getRuns(); // 新增後重新獲取跑步資料
          })
          .catch((error) => {
            console.error("新增跑步資料時出錯:", error);
          });
      } else {
        console.error("未登入用戶");
      }
    }

    // 獲取跑步資料
    function getRuns() {
      const user = firebase.auth().currentUser;
      if (user) {
        const runDate = `${currentYear}-${currentMonth.toString().padStart(2, '0')}-${currentDay.toString().padStart(2, '0')}`;

        firebase.firestore()
          .collection("users")
          .doc(user.uid)
          .collection("Records")
          .doc(runDate)
          .collection("run")
          .get()
          .then((snapshot) => {
            const runs = [];

            snapshot.forEach(doc => {
              const time = doc.id;
              const runData = doc.data();

              if (runData.run) {
                runs.push({ time, run: runData.run });
              }
            });

            if (Array.isArray(runs)) {
              displayRuns(currentYear, currentMonth, currentDay, runs);
            } else {
              console.error("跑步資料不是陣列格式");
              displayRuns(currentYear, currentMonth, currentDay, []);
            }
          })
          .catch((error) => {
            console.error("獲取跑步資料時出錯:", error);
          });
      } else {
        console.error("使用者未登入");
      }
    }

    // 顯示跑步資料
    function displayRuns(year, month, day, runs) {
      const runList = document.getElementById("runList");
      runList.innerHTML = "";

      if (!Array.isArray(runs)) {
        console.error("預期跑步資料為陣列");
        return;
      }

      runs.forEach(({ time, run }) => {
        const runElement = document.createElement("div");
        runElement.classList.add("run");

        const runTime = document.createElement("span");
        runTime.textContent = time; // 顯示時間
        runElement.appendChild(runTime);

        const runText = document.createElement("span");
        runText.textContent = `  ${run} 分鐘`; // 顯示跑步時間
        runElement.appendChild(runText);

        const deleteButton = document.createElement("button");
        deleteButton.textContent = "刪除";
        deleteButton.classList.add("btn-del"); 
        deleteButton.addEventListener("click", () => {
          deleteRun({ time, year, month, day });
        });

        runElement.appendChild(deleteButton);
        runList.appendChild(runElement);
      });
    }

    // 刪除跑步資料
    function deleteRun({ time, year, month, day }) {
      const user = firebase.auth().currentUser;
      if (!user) {
        console.error("使用者未登入");
        return;
      }

      if (!time || !year || !month || !day) {
        console.error("刪除資料所需的參數缺失:", { time, year, month, day });
        return;
      }

      const runDate = `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
      const runRef = firebase.firestore()
        .collection("users")
        .doc(user.uid)
        .collection("Records")
        .doc(runDate)
        .collection("run")
        .doc(time);

      runRef.get()
        .then((doc) => {
          if (doc.exists) {
            runRef.delete()
              .then(() => {
                console.log("跑步資料已刪除");
                getRuns(); // 刪除後重新獲取跑步資料
              })
              .catch((error) => {
                console.error("刪除跑步資料時出錯:", error);
              });
          } else {
            console.error("欲刪除的跑步資料不存在");
          }
        })
        .catch((error) => {
          console.error("檢查跑步資料是否存在時出錯:", error);
        });
    }
    getRuns();
  </script>
  <!--
路路路路路路路路路路路路路路路路路路路路路
路路路路路路路路　　　　路路路路路路路路路
路路路路路路路路　　　路路路路路路路路路路
路路路路路路路路　　　路路路路路路路路路路
路路路路路路路路　　　　　　　　　　路路路
路路路路路路路路　　　路路路路路路路路路路
路路路路路路路路　　　路路路路路路路路路路
路路路路路路路路　　　路路路路路路路路路路
路　　　　　　　　　　　　　　　　　　　路
路路路路路路路路　　　路路路路路路路　　路
路路路路路路路路　　　路路路路路路路路路路
路路路路路路路路　　　　　　路路路路路路路
路路路路路路路路　　　　　　　路路路路路路
路路路路路路路路　　　路路　　　　路路路路
路路路路路路路路　　　路路路　　　　路路路
路路路路路路路路　　　路路路路　　路路路路
路路路路路路路路　　　　路路路路路路路路路
路路路路路路路路　　　　路路路路路路路路路
路路路路路路路路　　　　路路路路路路路路路
路路路路路路路路路路路路路路路路路路路路路
  -->
  <script>
    // 新增卡路里
    function addcal() {
      const calInput = document.getElementById("calInput");
      const calValue = parseInt(calInput.value.trim()); // 將輸入轉為整數
      if (isNaN(calValue)) return; // 檢查輸入是否為有效數字

      const user = firebase.auth().currentUser;
      if (user) {
        const calDate = `${currentYear}-${currentMonth.toString().padStart(2, '0')}-${currentDay.toString().padStart(2, '0')}`;

        const now = new Date();
        const formattedTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;

        firebase.firestore()
          .collection("users")
          .doc(user.uid)
          .collection("Records")
          .doc(calDate)
          .collection("cal")
          .doc(formattedTime)
          .set({ cal: calValue }, { merge: true })
          .then(() => {
            console.log("卡路里資料已新增");
            calInput.value = ""; // 清空輸入框
            getcal(); // 新增後重新獲取卡路里資料
          })
          .catch((error) => {
            console.error("新增卡路里資料時出錯:", error);
          });
      } else {
        console.error("未登入用戶");
      }
    }

    // 獲取卡路里資料
    function getcal() {
      const user = firebase.auth().currentUser;
      if (user) {
        const calDate = `${currentYear}-${currentMonth.toString().padStart(2, '0')}-${currentDay.toString().padStart(2, '0')}`;

        firebase.firestore()
          .collection("users")
          .doc(user.uid)
          .collection("Records")
          .doc(calDate)
          .collection("cal")
          .get()
          .then((snapshot) => {
            const cal = [];

            snapshot.forEach(doc => {
              const time = doc.id;
              const calData = doc.data();

              if (calData.cal) {
                cal.push({ time, cal: calData.cal });
              }
            });

            if (Array.isArray(cal)) {
              displaycal(currentYear, currentMonth, currentDay, cal);
            } else {
              console.error("卡路里資料不是陣列格式");
              displaycal(currentYear, currentMonth, currentDay, []);
            }
          })
          .catch((error) => {
            console.error("獲取卡路里資料時出錯:", error);
          });
      } else {
        console.error("使用者未登入");
      }
    }

    // 顯示步數資料
    function displaycal(year, month, day, cal) {
      const calList = document.getElementById("calList");
      calList.innerHTML = "";

      if (!Array.isArray(cal)) {
        console.error("預期卡路里資料為陣列");
        return;
      }

      cal.forEach(({ time, cal }) => {
        const calElement = document.createElement("div");
        calElement.classList.add("cal");

        const calTime = document.createElement("span");
        calTime.textContent = time; // 顯示時間
        calElement.appendChild(calTime);

        const calText = document.createElement("span");
        calText.textContent = `  ${cal} 大卡`; // 顯示卡路里
        calElement.appendChild(calText);

        const deleteButton = document.createElement("button");
        deleteButton.textContent = "刪除";
        deleteButton.classList.add("btn-del"); 
        deleteButton.addEventListener("click", () => {
          deletecal({ time, year, month, day });
        });

        calElement.appendChild(deleteButton);
        calList.appendChild(calElement);
      });
    }

    // 刪除步數資料
    function deletecal({ time, year, month, day }) {
      const user = firebase.auth().currentUser;
      if (!user) {
        console.error("使用者未登入");
        return;
      }

      if (!time || !year || !month || !day) {
        console.error("刪除資料所需的參數缺失:", { time, year, month, day });
        return;
      }

      const calDate = `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
      const calRef = firebase.firestore()
        .collection("users")
        .doc(user.uid)
        .collection("Records")
        .doc(calDate)
        .collection("cal")
        .doc(time);

      calRef.get()
        .then((doc) => {
          if (doc.exists) {
            calRef.delete()
              .then(() => {
                console.log("卡路里資料已刪除");
                getcal(); // 刪除後重新獲取卡路里資料
              })
              .catch((error) => {
                console.error("刪除卡路里資料時出錯:", error);
              });
          } else {
            console.error("欲刪除的卡路里資料不存在");
          }
        })
        .catch((error) => {
          console.error("檢查卡路里資料是否存在時出錯:", error);
        });
    }
    getcal(); 
  </script>
  <!---待辦事項JS
辦辦辦辦辦辦辦辦辦辦辦辦辦辦辦辦辦辦辦辦辦
辦辦辦辦辦　　　辦辦辦　　　辦辦辦辦辦辦辦
辦辦辦辦　　　　辦辦辦　　　辦辦辦辦辦辦辦
辦辦辦　　　辦辦辦辦辦　　　辦辦辦　辦辦辦
辦辦　　　　辦　　　　　　　　　　　辦辦辦
辦　　　　　　辦辦辦辦　　　辦辦辦辦辦辦辦
辦　　　辦　　　辦辦辦　　　辦辦辦辦辦辦辦
辦辦辦辦　　　　　　　　　　　　　　　　辦
辦辦辦　　　　　　　　　　　　　　　　　辦
辦辦辦　　　辦辦辦辦辦辦辦辦　　　辦辦辦辦
辦辦　　　　辦辦辦辦辦辦辦辦　　　辦辦辦辦
辦　　　　　　　　　　　　　　　　　　　辦
辦　　　　　辦辦辦辦辦辦辦辦　　　辦辦辦辦
辦辦辦　　　辦辦　　　辦辦辦　　　辦辦辦辦
辦辦辦　　　辦辦　　　　辦辦　　　辦辦辦辦
辦辦辦　　　辦辦辦　　　　辦　　　辦辦辦辦
辦辦辦　　　辦辦辦辦辦辦辦辦　　　辦辦辦辦
辦辦辦　　　　辦辦辦辦辦　　　　　辦辦辦辦
辦辦辦　　　　辦辦辦辦辦　　　辦辦辦辦辦辦
辦辦辦辦辦辦辦辦辦辦辦辦辦辦辦辦辦辦辦辦辦
-->
  <script>
    function addTask() {
      const taskText = document.getElementById("taskInput").value.trim();
      if (taskText === "") return; // 如果任務文本為空則返回

      const user = firebase.auth().currentUser; // 獲取當前用戶
      if (user) {
        // 將日期格式化為 "YYYY-MM-DD"
        const taskDate = `${currentYear}-${currentMonth.toString().padStart(2, '0')}-${currentDay.toString().padStart(2, '0')}`;

        // 獲取當前時間並格式化為 hh:mm:ss
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        const formattedTime = `${hours}:${minutes}:${seconds}`; // 格式化為 hh:mm:ss

        // 在特定日期的文檔的 Tasks 子集合中添加任務
        firebase.firestore()
          .collection("users")
          .doc(user.uid)
          .collection("Records")
          .doc(taskDate) // 以日期作為文檔
          .collection("Tasks") // 子集合名為 Tasks
          .doc(formattedTime) // 使用 hh:mm:ss 作為文檔 ID，這樣每個任務會有唯一ID
          .set({ task: taskText }, { merge: true }) // 使用 task 作為欄位名稱
          .then(() => {
            console.log("任務已新增");
            document.getElementById("taskInput").value = ""; // 清空輸入框
            getTasks(); // 新增後重新獲取任務
          })
          .catch((error) => {
            console.error("新增任務時出錯:", error); // 捕捉錯誤
          });
      } else {
        console.error("未找到登入使用者"); // 未登錄的提示
      }
    }



    function getTasks() {
      const user = firebase.auth().currentUser;
      if (user) {
        const taskDate = `${currentYear}-${currentMonth.toString().padStart(2, '0')}-${currentDay.toString().padStart(2, '0')}`;

        // 獲取特定日期的任務（直接從日期文檔中獲取）
        db.collection("users")
          .doc(user.uid)
          .collection("Records")
          .doc(taskDate)
          .collection("Tasks") // 子集合名為 Tasks
          .get() // 获取该子集合中的所有文档
          .then((snapshot) => {
            const tasks = []; // 儲存所有任務的陣列

            // 遍历快照中的每个文档
            snapshot.forEach(doc => {
              const time = doc.id; // 使用文档 ID 作为时间（hh:mm:ss）
              const taskData = doc.data(); // 获取文档数据

              // 确保任务存在
              if (taskData.task) {
                tasks.push({ time, task: taskData.task }); // 将时间和任务推入数组
              }
            });

            // 确保 tasks 是数组，且在此处不會報錯
            if (Array.isArray(tasks)) {
              displayTasks(currentYear, currentMonth, currentDay, tasks); // 顯示任務
            } else {
              console.error("獲取的任務不是陣列");
              displayTasks(currentYear, currentMonth, currentDay, []);
            }
          })
          .catch((error) => {
            console.error("獲取任務時出錯:", error);
          });
      } else {
        console.error("未找到登入使用者");
      }
    }


    //函數：顯示任務列表  
    function displayTasks(year, month, day, tasks) {
      const taskList = document.getElementById("taskList");
      taskList.innerHTML = ""; // 清空当前任务列表

      // 检查任务是否存在
      if (!Array.isArray(tasks)) {
        console.error("任务格式错误，预期为数组");
        return;
      }

      tasks.forEach(({ time, task }) => {
        const taskElement = document.createElement("div");
        taskElement.classList.add("task");

        // 显示任务时间，转换为 hh:mm:ss 格式
        const formattedTime = time.replace(/-/g, ':'); // 替换 '-' 为 ':'

        const taskTime = document.createElement("span");
        taskTime.textContent = formattedTime; // 显示 hh:mm:ss 格式
        taskElement.appendChild(taskTime);

        // 显示任务内容
        const taskText = document.createElement("span");
        taskText.textContent = task; // 任务内容
        taskElement.appendChild(taskText);

        // 创建删除按钮
        const deleteButton = document.createElement("button");
        deleteButton.textContent = "刪除";
        deleteButton.classList.add("btn-del"); 
        deleteButton.addEventListener("click", () => {
          deleteTask({ time, year, month, day }); // 传递时间、年份、月份和日期
        });

        taskElement.appendChild(deleteButton); // 添加删除按钮
        taskList.appendChild(taskElement); // 将任务元素添加到任务列表中
      });
    }



    //刪除資料
    function deleteTask({ time, year, month, day }) {
      const user = firebase.auth().currentUser;
      if (!user) {
        console.error("未登入用戶，無法刪除任務");
        return;
      }

      // 确保所有参数都已定义
      if (!time || !year || !month || !day) {
        console.error("删除任务所需的参数未定义:", { time, year, month, day });
        return;
      }

      const taskDate = `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
      const taskRef = firebase.firestore().collection("users").doc(user.uid).collection("Records").doc(taskDate)
        .collection("Tasks").doc(time); // 使用时间作为文档 ID

      // 检查任务是否存在
      taskRef.get()
        .then((doc) => {
          if (doc.exists) {
            // 如果任务存在，删除它
            taskRef.delete()
              .then(() => {
                console.log("任務已刪除");
                getTasks(); // 刪除後重新獲取任務
              })
              .catch((error) => {
                console.error("刪除任務時出錯:", error);
              });
          } else {
            console.error("要刪除的任務不存在");
          }
        })
        .catch((error) => {
          console.error("檢查任務是否存在時出錯:", error);
        });
    }



    // 初始化日曆
    generateCalendar(currentYear, currentMonth);
    updateHeader(currentYear, currentMonth, currentDate.getDate());
    getTasks(); // 取得清單
    getWeights();
    getWaters();
    getSteps();
    getRuns();
    getcal();
  </script>





  <!------------------------------------下半部 footer 開始 --------------------------------------------------------->
  <footer id="footer" class="footer-area">
    <div class="footer-widget pt-80">
      <div class="container">
        <div class="row">
          <div class="col-lg-3 col-md-4 col-sm-8">
            <div class="footer-logo mt-50">
              <a href="#">
                <img src="image/logo.png" alt="Logo" />
              </a>

              <ul class="footer-social mt-20">
                <li>
                  <a href="#"><i class="lni-facebook-filled"></i></a>
                </li>
                <li>
                  <a href="#"><i class="lni-twitter-original"></i></a>
                </li>
                <li>
                  <a href="#"><i class="lni-google"></i></a>
                </li>
                <li>
                  <a href="#"><i class="lni-instagram"></i></a>
                </li>
              </ul>
            </div>
            <!-- footer logo -->
          </div>
          <div class="col-lg-3 col-md-4 col-sm-6">
            <div class="footer-link mt-45">
              <div class="f-title">
                <h4 class="title">關於LeisurePace</h4>
              </div>
              <ul class="mt-15">
                <li><a href="about.html">LeisurePace</a></li>
                <li><a href="about.html">超慢跑介紹</a></li>
              </ul>
            </div>
          </div>
          <div class="col-lg-3 col-md-4 col-sm-6">
            <div class="footer-link mt-45">
              <ul class="mt-15">
                <li><a href="./run/run180.html">超慢跑</a></li>
                <li><a href="analyze.html">分析</a></li>
                <li><a href="task.html">任務</a></li>
              </ul>
            </div>
          </div>
          <div class="col-lg-3 col-md-4 col-sm-6">
            <div class="footer-link mt-45">
              <ul class="mt-15">
                <li><a href="bgstore.html">背景介紹</a></li>
                <li><a href="personal.html">個人資料</a></li>
                <li><a href="connect.html">聯絡我們</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="copyright-area">
      <div class="container">
        <div class="row">
          <div class="col-lg-12">
            <div class="copyright text-center">
              <p>&copy; LeisurePace</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <!-- footer 結束 -->
</body>

</html>